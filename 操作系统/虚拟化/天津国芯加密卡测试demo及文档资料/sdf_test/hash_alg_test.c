#include <sdf.h>
#include <sdf_type.h>
#include <stdio.h>
#include <string.h>
#include <time.h>
#include <malloc.h>
#include <pthread.h>
#include <semaphore.h>

u8 hash_data1[] = {
		/* DATA 2 */
			0x2C,0xB6,0xA0,0x6E,0x92,0xDC,0x95,0x70,0x24,0x2E,0x4E,0x77,0xA1,0x8D,0x6D,0xF0,
			0xBF,0xA1,0x63,0xB7,0x33,0xA6,0x81,0xDF,0xA8,0x6F,0x48,0x65,0x0A,0x25,0x1F,0x76,
			0x2C,0xB6,0xA0,0x6E,0x92,0xDC,0x95,0x70,0x24,0x2E,0x4E,0x77,0xA1,0x8D,0x6D,0xF0,
			0xBF,0xA1,0x63,0xB7,0x33,0xA6,0x81,0xDF,0xA8,0x6F,0x48,0x65,0x0A,0x25,0x1F,0x76,
			0x2C,0xB6,0xA0,0x6E,0x92,0xDC,0x95,0x70,0x24,0x2E,0x4E,0x77,0xA1,0x8D,0x6D,0xF0,
			0xBF,0xA1,0x63,0xB7,0x33,0xA6,0x81,0xDF,0xA8,0x6F,0x48,0x65,0x0A,0x25,0x1F,0x76,
			0x2C,0xB6,0xA0,0x6E,0x92,0xDC,0x95,0x70,0x24,0x2E,0x4E,0x77,0xA1,0x8D,0x6D,0xF0,
			0xBF,0xA1,0x63,0xB7,0x33,0xA6,0x81,0xDF,0xA8,0x6F,0x48,0x65,0x0A,0x25,0x1F,0x76,
};

u8 sha1_stddata[] = {
	/* STD OUT 2 */
	0xf8,0x7b,0x6b,0x9a,0x7f,0x44,0x2d,0x26,0x88,0x6f,0xd1,0x5c,0xc3,0xf9,0xd0,0x2a,0xa3,0x4f,0xd8,0x88,

	0xe3,0xa0,0xc8,0x57,0xbc,0xaf,0xf9,0x3a,0x60,0xf6,0x1e,0x49,0x95,0x3a,0xc2,0x97,0x42,0x41,0x47,0xe5,
};


u8 sha256_stddata[] = {
	/* STD OUT 2 */
	0x46,0xa3,0x69,0x9b,0x9b,0x8a,0xad,0x1c,0xf8,0x15,0x71,0x16,0x38,0x50,0x2c,0x6f,
	0x80,0xb6,0x3f,0x5f,0x21,0x26,0x83,0xba,0xb0,0xa8,0x04,0x00,0x71,0xbd,0xfe,0x3c,

	0xee,0x94,0xb0,0xc4,0xd9,0x11,0x78,0x97,0x9e,0x2e,0x55,0x2a,0xce,0xe9,0xd5,0xd7,
	0x26,0x6e,0xbd,0x96,0x6e,0x10,0xd4,0xdf,0x4a,0x95,0x70,0x61,0xd3,0x04,0x1a,0xa5,
};

u8 sha512_stddata[] = {
	/* STD OUT 2 */
	0xc1,0x48,0x3e,0x30,0xcb,0x28,0x68,0x84,0xc3,0xde,0x66,0x60,0xdb,0xe5,0x88,0x56,
	0xea,0x13,0x11,0x4d,0x48,0x4b,0xce,0xe9,0xbe,0x63,0xef,0xfc,0x78,0x0c,0xe3,0xc9,
	0x9a,0x45,0x2c,0x01,0x60,0xb0,0x06,0x5e,0x09,0xf7,0xdc,0xb8,0xd2,0xaa,0x5f,0x3b,
	0xb6,0xa1,0x00,0x08,0x47,0x68,0x64,0x44,0x5a,0x92,0x98,0xb2,0x19,0x68,0xfa,0xaf,

	0x2a,0x31,0xcc,0xeb,0x3c,0xcc,0xa8,0x2d,0x7a,0x7b,0x8a,0x7f,0x9b,0xcd,0xb4,0x23,
	0x1b,0xd1,0x8c,0x6d,0x3d,0xa4,0xb8,0x63,0x06,0x8d,0xf8,0xed,0x3a,0x7d,0x86,0x9e,
	0xd0,0xa3,0xc9,0xbf,0xba,0x04,0xcd,0xdb,0x62,0x6e,0xc0,0x90,0xbd,0x3e,0x4f,0xc3,
	0x72,0xab,0x60,0x38,0xc4,0x60,0x5b,0x56,0xf8,0x76,0xba,0x91,0xe1,0xde,0xb5,0x0c,
};

u8 sha0_stddata[] = {
	/* STD OUT 2 */
	0x7c,0x49,0xa0,0x3c,0xba,0xd5,0x1a,0x78,0xdb,0x4e,0x81,0xd6,0xd7,0x0b,0x8a,0x60,0xe0,0x5b,0x8d,0xdb,

	0x86,0xa5,0x9e,0x66,0xf7,0x1e,0x57,0xa0,0xf8,0xba,0xf4,0xb6,0x51,0xcb,0xbc,0xe8,0x20,0x38,0xd6,0x09,
};

u8 sha224_stddata[] = {
	/* STD OUT 2 */
	0x70,0xc4,0xd0,0xeb,0xb5,0x61,0x56,0x70,0x87,0x97,0x4b,0x7c,0xff,0x29,0xe3,0xa1,
	0xd0,0xa5,0x65,0x7d,0x7d,0xfb,0x14,0x54,0xa5,0xc7,0x81,0x76,

	0xf9,0xc3,0x54,0xea,0x9d,0xad,0x5c,0x59,0x53,0x82,0xf6,0x7e,0xbd,0x04,0xb6,0xe0,
	0xbf,0x5e,0x8d,0x7d,0x22,0x3f,0x2c,0x6f,0xc1,0x01,0xf7,0x85,
};

u8 sha384_stddata[] = {
	/* STD OUT 2 */
	0x77,0x2e,0x3b,0xa4,0x7f,0x3d,0x98,0x43,0xcb,0x6d,0xf1,0x64,0x0c,0x94,0x72,0x50,
	0x3a,0xed,0x42,0x5d,0xcf,0xff,0xf8,0x4b,0xfe,0x0e,0x3f,0x4a,0x74,0x2e,0x26,0x41,
	0xd0,0xaa,0x1a,0xcf,0x63,0x54,0xc0,0x48,0x60,0x02,0xf4,0xc4,0xc8,0xea,0x4a,0xf5,

	0x70,0xb2,0x2f,0x81,0xaa,0x68,0xc5,0xb5,0x51,0x42,0x72,0x24,0x30,0x13,0xda,0xfd,
	0x85,0xb4,0x16,0xe5,0x00,0x68,0xe5,0x2c,0x22,0x40,0x90,0x18,0xdb,0x1f,0x66,0x2f,
	0xbf,0x90,0xda,0x3d,0xed,0x69,0x57,0x3f,0x83,0xc4,0xf0,0x35,0xd3,0xc9,0x70,0x18,
};

#define LOG_DATA(d, l)\
do\
{\
	int i;\
	for(i=0;i<l;i++)\
	{\
		if((i+1) % 16) \
			printf("%02X ", d[i]);\
		else\
			printf("%02X\n", d[i]);\
	}\
	if(i % 16) printf("\n");\
}\
while(0)

u32 SHA1_Test(void *hSessionHandle)
{
	unsigned int i,r;
	unsigned int data_size;
	BYTE *source_data = NULL;
	BYTE enc_data[100] = {0};
	int sm3_mode;
	u32 enc_len;
	u32 cnt = 0;
	unsigned char *pdata;


	pdata = (unsigned char *)&hash_data1[0];
	
	r = SDF_HashInit(hSessionHandle, SGD_SHA1, NULL, NULL, 0);
	if(r)
	{
		printf("SDF_HashInit error 0x%x\n", r);
	}

	r = SDF_HashUpdate(hSessionHandle, pdata, 32);
	if(r)
	{
		printf("SDF_HashUpdate error 0x%x\n", r);
	}

	enc_len = 100;
	r = SDF_HashFinal(hSessionHandle, enc_data , &enc_len);
	if(r)
	{
		printf("SDF_HashFinal error 0x%x\n", r);
	}

	for(i=0;i<enc_len;i++)
	{
		if(enc_data[i] != sha1_stddata[i])
		{
			printf("%s()-sha1 hash error!\n", __func__);
			LOG_DATA(enc_data, 32);
			return -1;
		}
	}
	
	printf("%s() - success\n", __func__);
	return r;
}


u32 SHA256_Test(void *hSessionHandle)
{
	unsigned int i,r;
	unsigned int data_size;
	BYTE *source_data = NULL;
	BYTE enc_data[100];
	int sm3_mode;
	u32 enc_len;
	u32 cnt = 0;
	unsigned char *pdata;


	pdata = (unsigned char *)&hash_data1[0];
	
	r = SDF_HashInit(hSessionHandle, SGD_SHA256, NULL, NULL, 0);
	if(r)
	{
		printf("SDF_HashInit error 0x%x\n", r);
	}

	r = SDF_HashUpdate(hSessionHandle, pdata, 32);
	if(r)
	{
		printf("SDF_HashUpdate error 0x%x\n", r);
	}

	enc_len = 100;
	r = SDF_HashFinal(hSessionHandle, enc_data , &enc_len);
	if(r)
	{
		printf("SDF_HashFinal error 0x%x\n", r);
	}

	for(i=0;i<enc_len;i++)
	{
		if(enc_data[i] != sha256_stddata[i])
		{
			printf("%s()-sha256 hash error!\n", __func__);
			LOG_DATA(enc_data, 32);
			return -1;
		}
	}
	
	printf("%s() - success\n", __func__);
	return r;
}

u32 SHA512_Test(void *hSessionHandle)
{
	unsigned int i,r;
	unsigned int data_size;
	BYTE *source_data = NULL;
	BYTE enc_data[100];
	int sm3_mode;
	u32 enc_len;
	u32 cnt = 0;
	unsigned char *pdata;


	pdata = (unsigned char *)&hash_data1[0];
	
	r = SDF_HashInit(hSessionHandle, SGD_SHA512, NULL, NULL, 0);
	if(r)
	{
		printf("SDF_HashInit error 0x%x\n", r);
	}

	r = SDF_HashUpdate(hSessionHandle, pdata, 32);
	if(r)
	{
		printf("SDF_HashUpdate error 0x%x\n", r);
	}

	enc_len = 100;
	r = SDF_HashFinal(hSessionHandle, enc_data , &enc_len);
	if(r)
	{
		printf("SDF_HashFinal error 0x%x\n", r);
	}

	for(i=0;i<enc_len;i++)
	{
		if(enc_data[i] != sha512_stddata[i])
		{
			printf("%s()-sha512 hash error!\n", __func__);
			LOG_DATA(enc_data, 64);
			return -1;
		}
	}
	
	printf("%s() - success\n", __func__);
	return r;
}


u32 SHA0_Test(void *hSessionHandle)
{
	unsigned int i,r;
	unsigned int data_size;
	BYTE *source_data = NULL;
	BYTE enc_data[100];
	int sm3_mode;
	u32 enc_len;
	u32 cnt = 0;
	unsigned char *pdata;


	pdata = (unsigned char *)&hash_data1[0];
	
	r = SDF_HashInit(hSessionHandle, SGD_SHA0, NULL, NULL, 0);
	if(r)
	{
		printf("SDF_HashInit error 0x%x\n", r);
	}

	r = SDF_HashUpdate(hSessionHandle, pdata, 32);
	if(r)
	{
		printf("SDF_HashUpdate error 0x%x\n", r);
	}

	enc_len = 100;
	r = SDF_HashFinal(hSessionHandle, enc_data , &enc_len);
	if(r)
	{
		printf("SDF_HashFinal error 0x%x\n", r);
	}

	for(i=0;i<enc_len;i++)
	{
		if(enc_data[i] != sha0_stddata[i])
		{
			printf("%s()-sha0 hash error!\n", __func__);
			LOG_DATA(enc_data, 64);
			return -1;
		}
	}
	
	printf("%s() - success\n", __func__);
	return r;
}

u32 SHA224_Test(void *hSessionHandle)
{
	unsigned int i,r;
	unsigned int data_size;
	BYTE *source_data = NULL;
	BYTE enc_data[100];
	int sm3_mode;
	u32 enc_len;
	u32 cnt = 0;
	unsigned char *pdata;


	pdata = (unsigned char *)&hash_data1[0];
	
	r = SDF_HashInit(hSessionHandle, SGD_SHA224, NULL, NULL, 0);
	if(r)
	{
		printf("SDF_HashInit error 0x%x\n", r);
	}

	r = SDF_HashUpdate(hSessionHandle, pdata, 32);
	if(r)
	{
		printf("SDF_HashUpdate error 0x%x\n", r);
	}

	enc_len = 100;
	r = SDF_HashFinal(hSessionHandle, enc_data , &enc_len);
	if(r)
	{
		printf("SDF_HashFinal error 0x%x\n", r);
	}

	for(i=0;i<enc_len;i++)
	{
		if(enc_data[i] != sha224_stddata[i])
		{
			printf("%s()-sha224 hash error!\n", __func__);
			LOG_DATA(enc_data, 64);
			return -1;
		}
	}
	
	printf("%s() - success\n", __func__);
	return r;
}

u32 SHA384_Test(void *hSessionHandle)
{
	unsigned int i,r;
	unsigned int data_size;
	BYTE *source_data = NULL;
	BYTE enc_data[100];
	int sm3_mode;
	u32 enc_len;
	u32 cnt = 0;
	unsigned char *pdata;


	pdata = (unsigned char *)&hash_data1[0];
	
	r = SDF_HashInit(hSessionHandle, SGD_SHA384, NULL, NULL, 0);
	if(r)
	{
		printf("SDF_HashInit error 0x%x\n", r);
	}

	r = SDF_HashUpdate(hSessionHandle, pdata, 32);
	if(r)
	{
		printf("SDF_HashUpdate error 0x%x\n", r);
	}

	enc_len = 100;
	r = SDF_HashFinal(hSessionHandle, enc_data , &enc_len);
	if(r)
	{
		printf("SDF_HashFinal error 0x%x\n", r);
	}

	for(i=0;i<enc_len;i++)
	{
		if(enc_data[i] != sha384_stddata[i])
		{
			printf("%s()-sha384 hash error!\n", __func__);
			LOG_DATA(enc_data, 64);
			return -1;
		}
	}
	
	printf("%s() - success\n", __func__);
	return r;
}