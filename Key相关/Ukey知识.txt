什么是PKI
    Public Key Infrastructure（PKI)，中文叫做公开密钥基础设施
    构成PKI的主要要素就是下面三个概念
        证明书 ：   证明书是被存放在硬盘或者IC卡里面的。
                    证明书的文件构造是一种叫做 X.509 的协议规定的
        认证机关 ： 认证机关也其实就是一个网络应用程序
        证书库 ：   文件系统，在网络上将证书存放在一起
        
智能密码钥匙是一种具备密码运算、密钥管理能力，可提供密码服务的终端密码设备。
其主要作用是存储用户私密信息（如私钥、数字证书）、完成数据加解密、数据完整性校验、数字签名、访问控制等功能。

智能密码钥匙与智能IC卡所用的控制芯片基本是相同的，业内一般统称为智能卡芯片。        

Ukey设备中存在设备认证密钥和多个应用，多个应用之间相互独立。
应用由管理员pin，用户pin，文件和容器组成，可以存在多个文件和多个容器。
每个应用维护各自的，[与管理员pin和用户pin相关的] 权限状态.

应用的管理包括创建、枚举、删除、打开、关闭等，分别有相应的SKF接口。
在创建应用时，需要指定应用名称、管理员PIN、用户PIN、PIN最大重试次数、在该应用下创建文件和容器的权限等。
打开应用可得到该应用的句柄。

文件管理包括文件的创建、删除、枚举、读写、获取文件信息等。这些操作都需要应用的句柄作为参数。

容器中存放加密密钥对、签名密钥对和会话密钥。
其中加密密钥对用于保护会话密钥，签名密钥对用于数字签名和验证，
会话密钥用户数据加解密和MAC运算。
容器中也可以存放于加密密钥对相对应的加密数字证书和与签名密钥对相对应的签名证书。
签名密钥对由内部产生，加密密钥对由外部产生并安全导入，会话密钥可由内部产生或由外部产生并安全导入。

智能密码钥匙应至少支持三种密钥：设备认证密钥、用户密钥、会话密钥
设备认证密钥用于电脑上的管理软件与UKey设备之间的相互鉴别，以获得对Ukey上应用的管理权限。
会话密钥是临时从外部密文导入，或内部临时生成的对称密钥，使用完毕或断电后立即消失。
加密密钥对是用于保护会话密钥用的，会话密钥完成数据加解密运算或MAC运算。

智能密钥除特殊情况，如需要与国际互联互通，正常应使用商用密码算法，
具体而言，公钥使用SM2或SM9，对称密码算法使用SM4，杂凑使用SM3。

容器的管理包括创建、删除、枚举、打开、关闭、获得容器类型、导入/导出数字证书等。
创建、删除、打开、关闭等方法需要传入应用的句柄、而获得容器类型、导入/导出数字证书则需要容器的句柄。

密码服务函数包括对称算法、非对称算法、杂凑运算、密钥管理、消息鉴别码计算、生成随机数等功能，具体参看GM/T 0016，7.6.1节。
GM/T 0016中还定义了RSA和ECC的公私钥数据结构、ECC密文数据结构、ECC签名数据结构等等。SKF接口也是在这里面定义的。

设备管理SKF接口：
等待设备插拔事件（阻塞函数）、取消等待设备插拔事件（使等待插拔函数立即返回）、
枚举设备、连接设备、断开设备、获取设备状态、获取设备标签、获取设备信息、锁定设备、解锁设备、设备命令传输

访问控制SKF接口：
修改设备认证密钥、设备认证、修改PIN、获得PIN码信息、验证PIN、解锁PIN、清除应用安全状态
获取PIN信息包括最大重试次数、当前剩余次数、是否是出厂默认的PIN码

设备的安全要求
    设备使用阶段分为两个：
        出厂阶段：预置了设备认证密钥、此阶段除修改设备认证密钥及创建应用外，不能进行其它操作
        应用阶段：此阶段已创建了应用，可进行所有操作。
    权限分类：
        设备权限： 通过设备认证后得到设备权限
        用户权限： 验证了用户PIN，用户权限只作用于其所在的应用
        管理员权限：管理员PIN验证通过，只作用于其所在的应用
    权限的使用：
        设备权限仅用于创建、删除应用和修改设备认证密钥，
        创建或删除容器需要用户权限
        创建文件的权限在创建应用时指定
        文件的读写权限在创建文件的时候指定
        容器内私钥的使用需要用户权限
        用户PIN的解锁需要管理员权限
        用户PIN的修改需要用户权限
        管理员PIN的修改需要管理员权限
    设备认证流程：
        调用SKF_GetRandom，从设备获取8字节的RND，填充到密码算法的分块长度，组成数据块D0
        对D0加密，得到D1，调用SKF_DevAuth，将D1发送到设备
        设备得到D1后，验证D1是否正确，成功则认证成功。
        