问：现在的宽带用户还是PPPoE方式吗？为什么不用进行拨号连接了？
答：家庭宽带都是用的PPPoE方式，不用进行手动拨号连接，是因为运营商把拨号连接功能内置在光猫中了

问：用户通过 PPPoE 协议拨号连入ISP，那么，用户的电脑是如何知道链路层使用PPPoE协议，而不是普通的以太网协议的？ 
答：其实电脑发送给网卡的是以太网数据，电脑或路由器连到光猫上，光猫负责把以太网协议包转为PPPoE协议包
    当然也可以设置路由器为PPPoE模式，这时，配置光猫只负责完成光电信号转换就可以了
    
问：建立好拨号连接后，我们发出的数据包还经过运营商吗？
答：是的，因为发出的数据包必然是经过光猫的，从光猫出去的输出包是PPPoE数据包，必然要经过ISP的处理、转发

问：光猫和运营商之间会经过路由器设备吗？
答：这个没在网上找到相关答案，这里可以试着分析一下
    假定经过路由器，则问题是路由器能不能处理 PPPoE 协议
    首先从协议格式上，PPPoE就是把用户电脑网络层的数据包装为PPPoE，再塞到EthernetII协议中
    而普通的以太网协议，就是直接在EthernetII协议中携带网络层（IP层）协议
    所以，从技术上，路由器是能处理PPPoE协议的，如果路由器支持PPPoE协议，
    那么PPPoE协议包从用户到达ISP，以及从ISP返回用户就不成问题了，
    在这种假设下，可以认为光猫和ISP是直通的，ISP可以使用PPP协议控制光猫的连接情况
    
=============================

目前流行的宽带接入方式ADSL就使用了PPPoE协议
随着低成本的宽带技术变得日益流行，
DSL(Digital Subscriber Line)数字用户线技术更是使得许多计算机在互联网上能够酣畅淋漓的冲浪了
但是这也增加了DSL服务提供商们对于网络安全的担心。
通过ADSL方式上网的计算机大都是通过以太网卡(Ethernet)与互联网相连的。
同样使用的还是普通的TCP/IP方式，并没有附加新的协议。
另外一方面，调制解调器的拨号上网，使用的是PPP协议，即Point to Point Protocol，点到点协议，
该协议具有用户认证及通知IP地址的功能。
PPP over Ethernet(PPPoE)协议，是在以太网络中转播PPP帧信息的技术，尤其适用于ADSL等方式。

DSL 和 ADSL
    DSL的中文名是数字用户线路，是以电话线为传输介质的传输技术组合
    DSL 包括 ADSL、RADSL、HDSL和VDSL等等
    ADSL属于DSL技术的一种，全称Asymmetric Digital Subscriber Line（ 非对称数字用户线路），
    亦可称作非对称数字用户环路。
    是一种新的数据传输方式，因为其提供的上行和下行带宽不对称，因此称为非对称数字用户线路
    
    ADSL技术采用频分复用技术把普通的电话线分成了电话、上行和下行三个相对独立的信道，从而避免了相互之间的干扰
    用户可以边打电话边上网，不用担心上网速率和通话质量下降的情况，因此网速也快了很多。
    ADSL技术至今在我国某些地区仍在使用，即是早期的猫，与之对应的是光猫
    但其实两者都是使用 pppoe 拨号上网
    
    随着时代发展， 拨号上网和猫这两者既可以分开，也可以在一起
    分开的：
        ADSL / 光纤 入户，你在 ADSL / 光纤 猫上只做接口转换，通过路由器或者 PC 拨号均可。
    一起的：
        以前我家用的 ADSL 线路，运营商直接给一个带 拨号功和无线功能的 ADSL 猫。
        无线路由器都不需要买，直接通过 ADSL 猫实现拨号和 无线路由器的功能。
    ADSL猫就是将ADSL协议/接口转换成普通以太网协议/接口
    电话拨号和 xDSL 技术基本已经死掉了，现在常用的接入技术为 PON/LAN

LAN+PON介绍
    PON（Passive Optical Network）即无源光网络
    PON是一种采用点到多点（P2MP）结构的单纤双向光接入网络。
    PON种类：
        (1)APON
            APON由于其复杂性和低数据传输效率，已经在竞争中逐步退出市场
        (2)EPON
            EPON是基于以太网技术的宽带接入系统，它利用PON的拓扑结构实现以太网的接入
        (3)GPON
    局域网（Local Area Network），简称LAN
    PON+LAN是我国目前局域网中的有线接入技术
    
简要分析光猫是如何通过运营商实现上网的    
https://zhuanlan.zhihu.com/p/349957821
    名词：
        光猫： 一种基于光信号传输数据的终端设备
        二分： 一种用于对光信号分散以及聚合的无源（就是没电）设备
        一分： 一种对二分光信号聚合和分散的无源设备
        odf架：一种对一分的线缆进行规范排列的设备
        olt：  一种对光猫进行控制，验证和数据下发的管理级设备
        bras： 一种基于pppoe协议实现宽带账号认证与网速限制的服务器设备
    首先从光猫讲起
        目前光猫模式可分为
        sfu（路由器拨号），
        hgu（光猫或者路由器拨号），
        ihgu（除了hgu的功能外，另加上了物联网控制功能）。
        
        光猫的类型可分为epon（以太网光网络）与gpon（吉比特光网络）
        gpon比epon承载的速率更高
        运营商如果要将epon更换成gpon，将会有很高的成本
        最先推出宽带的电信基本采用epon，后出宽带的移动和联通基本都是gpon
        
        第一节光猫：
            首先关于光猫是否需要（与路由器）开启桥接的问题，
                个人观点，看情况
                由于光猫开路由将会影响光猫的工作功率，
                在未具备良好散热的情况下，可考虑减少光猫负担使用桥接
                另外一个需要考虑的是你的宽带是不是公网
                不是就无所谓了，桥接模式的只有公网宽带下的需要端口转发的网络才桥接
                不要没事桥接，没什么意义，而且光猫对 pppoe 里面的特性有做优化
                在某种程度上面来说，路由模式比桥接模式可能更具有稳定性
            其次关于光猫的 wifi 
                个人认为可以用，但是建议尽量不用
                并不是说光猫的 wifi 不好，
                而是开启 wifi 后会增加光猫的功耗是光猫的散热能力减弱
                从而影响网络的整体表现，
            最后说一点，光猫的 lan 口是基于路由模式的，并不是基于交换机模式的，
            路由模式决定了，光猫的各个 lan 口到底用于传输什么数据
            即你可以 3 口上网（这个就光猫只能开光猫拨号了）、1 口看电视，
            所以，光猫并不是只有一个口可以上网，而是光猫有几个网线口，
            就可以有几个口上网，并不一定只能用 1 口上网喔。
        第二节：分光器
            你的光猫不仅仅只接受你的数据，还会接收别人的数据，只是光猫不做处理罢了
            你的光猫可以接受别人的数据，该特性即由分光器完成
            分光器是一个纯机械设备，并不用通电，就可以完成相应的功能
            其分发原理主要是将一路输入通过一个分发棱镜均匀的分发到每一个出口上面，
            实现 1 分 4 到 1 分 16
        。。。
        
https://blog.51cto.com/fighterbar/777818
    PPPOE拨号后得到的地址是32位掩码，网关与IP地址相同都是正确的，
    原因和BAS（接入服务器）的工作原理有关
    PPPOE用户上网的过程
        首先用户会在主机上运行PPPOE拨号程序（如ETHERNET600或XP自带的拨号程序），
        拨号的主要目的就是拿到IP地址，
        请求到达BAS后，在BAS上会配置的PPPOE Server负责回应请求，
        进行认证检查（最基本的就是看用户名密码是否正确），
        决定是否给发送请求的主机分配IP地址。
        认证通过后BAS就从IP POOL（IP地址池）中挑选一个地址发给主机，
        这个地址就是你看到的掩码32位的地址。
        掩码为什么是32位，网关为什么是自己？
        前面提到了主机地址是从IP POOL中得到的，
        IP POOL一般都配成一段地址，如一个或半个C类地址等等。
        所有的PPPOE拨号主机的地址都从IP POOL中分配，
        对于主机来讲32位掩码地址已经足够，并不影响正常通讯，
        打个比方，router的Loopback0地址是32位掩码的，我们经常用这个地址作为telnet,
        Ftp的通讯地址，主机用32位掩码地址的道理与Loopback0地址类似，它并不影响服务。
        还有就是为了节约地址资源，
        大家知道如果掩码是30位的话，4个地址中要浪费两个地址作为网络地址和广播地址，
        主机地址只能用另外两个。
        32位掩码节约了大量的地址资源。
        主机得到地址后，网关是自己，那它如何通讯呢？
        这就是BAS的基本功能了，主机拨号得到地址后，
        就相当于与BAS直连的一个虚端口，BAS上面增加一条针对主机地址的直连路由。
        然后我们分析上网的过程，主机开始发送数据包，数据包到达BAS，
        BAS此时就象一个router，它检查从主机过来的数据包中的目的地址，
        如果路由表中有针对此目的地址的条目，那么BAS将数据包发送到下一跳，
        如果没有，BAS按照缺省路由指定的下一跳转发。
        通常主机发送的数据包都是按照缺省路由转发的，
        除非是连到同一个BAS的两个PPPOE主机之间的通讯。
        现在我们知道主机发出的数据包如何被转发了，那么回到主机的数据包怎么办呢？
        很简单，通常来讲，BAS上面就是router,
        在router上面做一条针对IP POOL的静态路由，指到BAS，然后将它发布到internet。
        这样，目的地址是某PPPOE主机的数据包首先会到达BAS，
        然后BAS会按照32位掩码地址将其转发给指定的主机。
        路由器的POS接口地址掩码是30位是因为它需要和对端互通，30位掩码是最合适的，够用而且不浪费。
        ARP表中不显示应该是因为POS接口是点对点通讯，
        不象ethernet是点到多点的通讯，需要知道每个MAC地址与IP地址的捆绑关系。
        有的设备POS接口是有MAC地址的，但是在ARP表中只会显示本地POS接口和IP地址的捆绑关系，
        不象ethernet接口，即有本地接口的MAC地址与IP地址的捆绑关系，
        又有通过ARP学习到的对端地址的MAC地址与IP地址的捆绑关系。

PPPoE协议及其工作过程
	在TCP/IP协议栈中，PPPOE协议是一种网络层协议，也就是第三层（网络层）协议。
	PPPOE协议是通过将IP数据包从PPP会话的第二层（传输层）封装在IP数据包中来进行通信的。
	当用户通过PPPOE协议建立拨号连接时，PPP会话的第二层信息被转换为IP数据包的网络层信息，以便能够在互联网上传输。
	PPPOE协议使用PPP的用户数据控制协议（UDP）作为网络层协议，
	同时也使用一些其他的协议，例如帧同步协议（FSS）和传输控制协议（TCP）等。
	
    https://blog.csdn.net/xinyuan510214/article/details/51361853
    https://blog.csdn.net/xinyuan510214/article/details/79635015
    PPPoE的报文就是在PPP的报文前面再加上以太网的报头，使得PPPoE可以通过简单桥接设备连入远端接入设备。
    [Ethernet header]   [PPPoE header]   [PPP header]   [PPP data]   [PCS]
    参： file://imgs/pppoe协议格式.png
    上图中的解释：
        以太网协议部分：
            Destination_address：
                一个以太网单播目的地址或者以太网广播地址（0xffffffff）。
                对于Discovery数据包来说，该域的值是单播或者广播地址，
                PPPoE Client寻找PPPoE Server的过程使用广播地址，
                （这里的 PPPoE Server 通常就是 ISP）
                确认PPPoE Server后使用单播地址。
                对于Session阶段来说，该域必须是Discovery阶段已确定的通信对方的单播地址。
            Source_address：
                源设备的以太网MAC地址。  
            Ether_type：
                设置为0x8863（Discovery阶段或拆链阶段）或者0x8864（Session阶段）。
        pppoe协议部分
            Ver：
                4bits，PPPoE版本号，值为0x1。 
            Type域：
                4bits，PPPoE类型，值为0x1。  
            Code：
                8bits，PPPoE报文类型。
                Code域为0x00，表示会话数据。
                Code域为0x09，表示PADI报文；
                Code域为0x07，表示PADO或PADT报文；
                Code域为0x19，表示PADR报文；
                Code域为0x65，表示PADS报文。
            Session_ID：
                16bits，对于一个给定的PPP会话，该值是一个固定值，
                并且与以太网Source_address和Destination_address一起实际地定义了一个PPP会话。
                值0xffff为将来的使用保留，不允许使用。  
            Length：
                16bits，定义PPPoE的Payload域长度。不包括以太网头部和PPPoE头部的长度。
            数据：
                有时也称之为净载荷域，在PPPOE的不同阶段该域内的数据内容会有很大的不同。
                在PPPOE的发现阶段时，该域内会填充一些Tag（标记）；
                而在PPPOE的会话阶段，该域则携带的是标准的点对点协议包。        
    