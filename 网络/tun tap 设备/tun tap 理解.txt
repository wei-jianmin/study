https://zhuanlan.zhihu.com/p/260405786
TUN 是一个虚拟网络设备，它模拟的是一个三层设备，
通过它可以处理来自网络层的数据包，也就是 IP 数据包。
由于它只模拟到了 IP 层，所以它无法与物理网卡做 bridge，也没有 MAC 地址

TAP 模拟的是一个二层设备，它比 TUN 更加深入，
它可以处理数据链路层的数据包，拥有 MAC 地址，
可以与物理网卡做 bridge，支持 MAC 层广播，也可以给它设置 IP 地址。

tap/tun 驱动程序包括两个部分：字符设备驱动，网卡驱动
通过 CreateFile,ReadFile 方式打开并操作tun或tap设备时，
是使用的字符设备驱动，是不过协议栈的
往tun上写了数据，tun的网卡驱动就会调用协议栈的方法(内核api)，
将数据一层层往上传递，直到tcp或udp层收到数据
当应用程序发送tcp/udp包时，经过协议栈处理后，变成ip包，
然后根据目的ip，查路由表，找到对应网络设备的驱动，
如果是tun设备的驱动，则将ip包交付给tun的网卡驱动，
这是，tun的字符设备驱动就有数据可读了
如果根据路由表，找到的是tap设备的驱动，则tap设备的网卡驱动会
把交付给他的ip包，进一步处理成以太网包，然后tap的字符设备驱动才有数据可读
而通过字符设备驱动，发给tap的数据（以太网数据包），
也要经过tap网卡驱动的处理，变成ip包后，才向上交付给网络协议栈